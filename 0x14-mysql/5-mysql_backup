#!/usr/bin/env bash
# Check if the password argument is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <mysql-root-password>"
    exit 1
fi

MYSQL_PASSWORD=$1

# Generate the MySQL dump
mysqldump -u root -p"$MYSQL_PASSWORD" --all-databases > backup.sql

# Check if the mysqldump was successful
if [ $? -ne 0 ]; then
    exit 1
fi

# Get the current date in day-month-year format
DATE=$(date +%d-%m-%Y)

# Compress the dump file into a tar.gz archive
tar -czvf $DATE.tar.gz backup.sql

# Check if the tar command was successful
if [ $? -ne 0 ]; then
    exit 1
fi

# Cleanup the uncompressed dump file
rm backup.sql

echo "Backup completed: $DATE.tar.gz"